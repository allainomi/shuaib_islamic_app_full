name: Validate with Artifacts

on:
  push:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Create Project Analysis Files
      run: |
        echo "ðŸ” Creating project analysis artifacts..."
        
        # 1. Project structure file
        echo "ðŸ“ PROJECT STRUCTURE" > project-structure.txt
        echo "====================" >> project-structure.txt
        ls -la >> project-structure.txt
        echo "" >> project-structure.txt
        echo "App Directory:" >> project-structure.txt
        ls -la app/ >> project-structure.txt 2>/dev/null || echo "No app directory" >> project-structure.txt
        
        # 2. Source code summary
        echo "ðŸ“Š SOURCE CODE SUMMARY" > code-summary.txt
        echo "======================" >> code-summary.txt
        echo "Java files: $(find . -name '*.java' | wc -l)" >> code-summary.txt
        echo "Kotlin files: $(find . -name '*.kt' | wc -l)" >> code-summary.txt
        echo "XML files: $(find . -name '*.xml' | wc -l)" >> code-summary.txt
        echo "Gradle files: $(find . -name '*.gradle*' | wc -l)" >> code-summary.txt
        
        # 3. File list
        find . -type f -name "*.java" -o -name "*.kt" -o -name "*.xml" -o -name "*.gradle*" | sort > file-list.txt
        
        # 4. Build info
        echo "ðŸ› ï¸ BUILD INFORMATION" > build-info.txt
        echo "====================" >> build-info.txt
        date >> build-info.txt
        echo "Repository: https://github.com/allainomi/shuaib_islamic_app_full" >> build-info.txt
        echo "Branch: main" >> build-info.txt
        
        echo "âœ… Analysis files created successfully!"

    - name: Upload Project Analysis Artifact
      uses: actions/upload-artifact@v4
      with:
        name: project-analysis-report
        path: |
          project-structure.txt
          code-summary.txt
          file-list.txt
          build-info.txt
        retention-days: 30

    - name: Upload Source Code Sample
      uses: actions/upload-artifact@v4
      with:
        name: source-code-samples
        path: |
          app/src/main/AndroidManifest.xml
          app/build.gradle
          build.gradle
        if-no-files-found: ignore
        retention-days: 30

    - name: Create Summary
      run: |
        echo "## ðŸŽ‰ Validation Completed Successfully!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“¦ Generated Artifacts:" >> $GITHUB_STEP_SUMMARY
        echo "- **project-analysis-report**: Project structure and code analysis" >> $GITHUB_STEP_SUMMARY
        echo "- **source-code-samples**: Key source files" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ” Analysis Results:" >> $GITHUB_STEP_SUMMARY
        echo "- Java files: $(find . -name '*.java' | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- Kotlin files: $(find . -name '*.kt' | wc -l)" >> $GITHUB_STEP_SUMMARY
        echo "- Total code files: $(find . -name '*.java' -o -name '*.kt' | wc -l)" >> $GITHUB_STEP_SUMMARY
